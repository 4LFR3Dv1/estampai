<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstampAI - Debug Framer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .debug-section {
            background: #111111;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333333;
        }
        
        .debug-title {
            color: #667eea;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .debug-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #222222;
        }
        
        .debug-item:last-child {
            border-bottom: none;
        }
        
        .debug-label {
            color: #ffffff;
            font-weight: 500;
        }
        
        .debug-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .status-pass {
            background: #1b2d1b;
            color: #51cf66;
        }
        
        .status-fail {
            background: #2d1b1b;
            color: #ff6b6b;
        }
        
        .status-warning {
            background: #2d2b1b;
            color: #ffd43b;
        }
        
        .debug-log {
            background: #0a0a0a;
            border: 1px solid #333333;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #ffffff;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 5px;
        }
        
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç EstampAI - Debug Framer</h1>
        
        <div class="debug-section">
            <div class="debug-title">üåê Ambiente</div>
            <div class="debug-item">
                <span class="debug-label">User Agent</span>
                <span class="debug-status status-pass" id="user-agent">‚úÖ Detectado</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">URL Atual</span>
                <span class="debug-status status-pass" id="current-url">‚úÖ Detectado</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">√â iframe?</span>
                <span class="debug-status status-warning" id="is-iframe">‚ö†Ô∏è Verificando</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Parent Domain</span>
                <span class="debug-status status-warning" id="parent-domain">‚ö†Ô∏è Verificando</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">üîß APIs Dispon√≠veis</div>
            <div class="debug-item">
                <span class="debug-label">localStorage</span>
                <span class="debug-status status-pass" id="localStorage-test">‚úÖ OK</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">IndexedDB</span>
                <span class="debug-status status-pass" id="indexeddb-test">‚úÖ OK</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Fetch API</span>
                <span class="debug-status status-pass" id="fetch-test">‚úÖ OK</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Canvas</span>
                <span class="debug-status status-pass" id="canvas-test">‚úÖ OK</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">üö´ CORS e Seguran√ßa</div>
            <div class="debug-item">
                <span class="debug-label">CORS Headers</span>
                <span class="debug-status status-warning" id="cors-test">‚ö†Ô∏è Testando</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">X-Frame-Options</span>
                <span class="debug-status status-warning" id="frame-options-test">‚ö†Ô∏è Testando</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Content Security Policy</span>
                <span class="debug-status status-warning" id="csp-test">‚ö†Ô∏è Testando</span>
            </div>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">üß™ Testes</div>
            <button class="test-button" onclick="testAPICall()">Testar API Call</button>
            <button class="test-button" onclick="testAvatarLoad()">Testar Avatar</button>
            <button class="test-button" onclick="testChat()">Testar Chat</button>
            <button class="test-button" onclick="clearLogs()">Limpar Logs</button>
        </div>
        
        <div class="debug-section">
            <div class="debug-title">üìù Logs</div>
            <div class="debug-log" id="debug-log">Aguardando testes...\n</div>
        </div>
    </div>

    <script>
        let debugLog = document.getElementById('debug-log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.textContent += `[${timestamp}] ${message}\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        function clearLogs() {
            debugLog.textContent = 'Logs limpos...\n';
        }
        
        // Verifica√ß√µes iniciais
        document.addEventListener('DOMContentLoaded', function() {
            log('üîç Iniciando debug do EstampAI...');
            
            // User Agent
            document.getElementById('user-agent').textContent = navigator.userAgent.includes('Framer') ? 'üé® Framer' : 'üåê Browser';
            
            // URL Atual
            document.getElementById('current-url').textContent = window.location.href;
            
            // √â iframe?
            const isIframe = window !== window.top;
            document.getElementById('is-iframe').textContent = isIframe ? '‚úÖ Sim' : '‚ùå N√£o';
            document.getElementById('is-iframe').className = isIframe ? 'debug-status status-pass' : 'debug-status status-fail';
            
            // Parent Domain
            try {
                const parentDomain = window.parent.location.hostname;
                document.getElementById('parent-domain').textContent = parentDomain;
                document.getElementById('parent-domain').className = 'debug-status status-pass';
                log(`‚úÖ Parent domain: ${parentDomain}`);
            } catch (e) {
                document.getElementById('parent-domain').textContent = '‚ùå Bloqueado';
                document.getElementById('parent-domain').className = 'debug-status status-fail';
                log(`‚ùå Parent domain bloqueado: ${e.message}`);
            }
            
            // Teste de APIs
            testAPIs();
            
            // Teste de CORS
            testCORS();
        });
        
        function testAPIs() {
            log('üß™ Testando APIs...');
            
            // localStorage
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                log('‚úÖ localStorage funcionando');
            } catch (e) {
                log(`‚ùå localStorage erro: ${e.message}`);
                document.getElementById('localStorage-test').textContent = '‚ùå Erro';
                document.getElementById('localStorage-test').className = 'debug-status status-fail';
            }
            
            // IndexedDB
            if ('indexedDB' in window) {
                log('‚úÖ IndexedDB dispon√≠vel');
            } else {
                log('‚ùå IndexedDB n√£o dispon√≠vel');
                document.getElementById('indexeddb-test').textContent = '‚ùå N√£o dispon√≠vel';
                document.getElementById('indexeddb-test').className = 'debug-status status-fail';
            }
            
            // Fetch
            if ('fetch' in window) {
                log('‚úÖ Fetch API dispon√≠vel');
            } else {
                log('‚ùå Fetch API n√£o dispon√≠vel');
                document.getElementById('fetch-test').textContent = '‚ùå N√£o dispon√≠vel';
                document.getElementById('fetch-test').className = 'debug-status status-fail';
            }
            
            // Canvas
            const canvas = document.createElement('canvas');
            if (canvas.getContext) {
                log('‚úÖ Canvas dispon√≠vel');
            } else {
                log('‚ùå Canvas n√£o dispon√≠vel');
                document.getElementById('canvas-test').textContent = '‚ùå N√£o dispon√≠vel';
                document.getElementById('canvas-test').className = 'debug-status status-fail';
            }
        }
        
        async function testCORS() {
            log('üåê Testando CORS...');
            
            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer test-key'
                    }
                });
                
                if (response.status === 401) {
                    log('‚úÖ CORS funcionando (401 esperado)');
                    document.getElementById('cors-test').textContent = '‚úÖ OK';
                    document.getElementById('cors-test').className = 'debug-status status-pass';
                } else {
                    log(`‚ö†Ô∏è CORS resposta inesperada: ${response.status}`);
                    document.getElementById('cors-test').textContent = '‚ö†Ô∏è Inesperado';
                    document.getElementById('cors-test').className = 'debug-status status-warning';
                }
            } catch (e) {
                log(`‚ùå CORS erro: ${e.message}`);
                document.getElementById('cors-test').textContent = '‚ùå Erro';
                document.getElementById('cors-test').className = 'debug-status status-fail';
            }
        }
        
        async function testAPICall() {
            log('üöÄ Testando chamada da API...');
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_OPENAI_API_KEY_HERE'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: 'test' }],
                        max_tokens: 10
                    })
                });
                
                log(`üì° Resposta da API: ${response.status} ${response.statusText}`);
                
                if (response.status === 401) {
                    log('‚úÖ API key n√£o configurada (esperado)');
                } else if (response.status === 400) {
                    log('‚ö†Ô∏è Bad Request - poss√≠vel problema com a requisi√ß√£o');
                } else {
                    log(`‚ÑπÔ∏è Status inesperado: ${response.status}`);
                }
                
            } catch (e) {
                log(`‚ùå Erro na chamada da API: ${e.message}`);
            }
        }
        
        async function testAvatarLoad() {
            log('üñºÔ∏è Testando carregamento do avatar...');
            
            try {
                const img = new Image();
                img.onload = function() {
                    log('‚úÖ Avatar carregado com sucesso');
                };
                img.onerror = function() {
                    log('‚ùå Erro ao carregar avatar');
                };
                img.src = 'https://estampai.onrender.com/AVATAR.png';
            } catch (e) {
                log(`‚ùå Erro no teste do avatar: ${e.message}`);
            }
        }
        
        async function testChat() {
            log('üí¨ Testando funcionalidade do chat...');
            
            // Simula o que acontece no chat
            try {
                const conversationHistory = [];
                const message = 'teste';
                
                conversationHistory.push({
                    role: 'user',
                    content: message,
                    timestamp: new Date()
                });
                
                log(`‚úÖ Mensagem adicionada ao hist√≥rico: ${message}`);
                log(`üìä Hist√≥rico tem ${conversationHistory.length} mensagens`);
                
                // Testa se consegue fazer a requisi√ß√£o
                await testAPICall();
                
            } catch (e) {
                log(`‚ùå Erro no teste do chat: ${e.message}`);
            }
        }
    </script>
</body>
</html>
